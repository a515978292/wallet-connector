/**
 * ============================================
 * ğŸ“¦ Web3 Providers é…ç½®æ–‡ä»¶
 * ============================================
 *
 * è¿™ä¸ªæ–‡ä»¶çš„ä½œç”¨ï¼šç»™æ•´ä¸ªåº”ç”¨æä¾› Web3 èƒ½åŠ›
 * å°±åƒç»™æˆ¿å­æ¥é€šæ°´ç”µä¸€æ ·ï¼Œè®©æ‰€æœ‰æˆ¿é—´éƒ½èƒ½ç”¨ä¸Š
 *
 * åŒ…å«ä¸¤ä¸ªæ ¸å¿ƒåŠŸèƒ½ï¼š
 * 1. é’±åŒ…è¿æ¥ï¼ˆWagmiProviderï¼‰
 * 2. æ•°æ®ç¼“å­˜ï¼ˆQueryClientProviderï¼‰
 */

"use client"; // âš ï¸ å¿…é¡»æ ‡è®°ä¸ºå®¢æˆ·ç«¯ç»„ä»¶ï¼Œå› ä¸ºéœ€è¦æµè§ˆå™¨ç¯å¢ƒ

// ==================== ç¬¬ä¸€æ­¥ï¼šå¯¼å…¥æ‰€éœ€çš„åº“ ====================

// ä» wagmi å¯¼å…¥ï¼šæ ¸å¿ƒçš„ Web3 React Hooks åº“
import { WagmiProvider, createConfig, http } from "wagmi";

// å¯¼å…¥åŒºå—é“¾ç½‘ç»œé…ç½®ï¼šmainnetï¼ˆä¸»ç½‘ï¼‰å’Œ sepoliaï¼ˆæµ‹è¯•ç½‘ï¼‰
import { mainnet, sepolia } from "wagmi/chains";

// ä» React Query å¯¼å…¥ï¼šç”¨äºç®¡ç†å¼‚æ­¥æ•°æ®ï¼ˆç¼“å­˜ã€è‡ªåŠ¨åˆ·æ–°ç­‰ï¼‰
import { QueryClient, QueryClientProvider } from "@tanstack/react-query";

// å¯¼å…¥é’±åŒ…è¿æ¥å™¨ï¼šæ”¯æŒä¸åŒçš„é’±åŒ…ç±»å‹
import { injected } from "wagmi/connectors";
// import { walletConnect } from "wagmi/connectors"; // å¦‚éœ€ç§»åŠ¨ç«¯é’±åŒ…æ”¯æŒå¯å–æ¶ˆæ³¨é‡Š

// ==================== ç¬¬äºŒæ­¥ï¼šé…ç½® Web3 è¿æ¥ ====================

/**
 * åˆ›å»º wagmi é…ç½®
 *
 * è¿™å°±åƒé…ç½®ä½ çš„"ç½‘ç»œè®¾ç½®"ï¼š
 * - chains: æ”¯æŒå“ªäº›åŒºå—é“¾ç½‘ç»œ
 * - connectors: æ”¯æŒå“ªäº›é’±åŒ…è¿æ¥æ–¹å¼
 * - transports: æ¯ä¸ªé“¾çš„ RPC è¿æ¥é…ç½®
 */
const config = createConfig({
  // æ”¯æŒçš„åŒºå—é“¾ç½‘ç»œåˆ—è¡¨
  // mainnet = ä»¥å¤ªåŠä¸»ç½‘ï¼ˆChain ID: 1ï¼‰
  // sepolia = ä»¥å¤ªåŠæµ‹è¯•ç½‘ï¼ˆChain ID: 11155111ï¼‰
  // ğŸ’¡ å¼€å‘æ—¶ç”¨ sepoliaï¼Œä¸Šçº¿åå¯ä»¥åŠ å…¥ mainnet
  //   chains: [mainnet, sepolia],
  chains: [sepolia],

  // é…ç½®æ¯ä¸ªé“¾çš„ RPC ä¼ è¾“æ–¹å¼
  transports: {
    // [mainnet.id]: http(),
    [sepolia.id]: http(),
  },
});

// ==================== ç¬¬ä¸‰æ­¥ï¼šåˆ›å»º Query Client ====================

/**
 * åˆ›å»º QueryClient å®ä¾‹
 *
 * ä½œç”¨ï¼šç®¡ç†æ‰€æœ‰çš„æ•°æ®è¯·æ±‚å’Œç¼“å­˜
 * - è‡ªåŠ¨ç¼“å­˜ï¼šé¿å…é‡å¤è¯·æ±‚ç›¸åŒæ•°æ®
 * - è‡ªåŠ¨åˆ·æ–°ï¼šæ•°æ®è¿‡æœŸæ—¶è‡ªåŠ¨æ›´æ–°
 * - ä¼˜åŒ–æ€§èƒ½ï¼šå‡å°‘å¯¹åŒºå—é“¾èŠ‚ç‚¹çš„è°ƒç”¨
 *
 * ç±»æ¯”ï¼šå°±åƒæµè§ˆå™¨çš„ç¼“å­˜ï¼Œè®°ä½ä½ è®¿é—®è¿‡çš„ç½‘é¡µ
 */
const queryClient = new QueryClient();

// ==================== ç¬¬å››æ­¥ï¼šå¯¼å‡º Providers ç»„ä»¶ ====================

/**
 * Providers ç»„ä»¶
 *
 * è¿™ä¸ªç»„ä»¶ä¼šåŒ…è£¹æ•´ä¸ªåº”ç”¨ï¼ˆåœ¨ layout.tsx ä¸­ä½¿ç”¨ï¼‰
 *
 * @param {React.ReactNode} children - å­ç»„ä»¶ï¼ˆä½ çš„æ•´ä¸ªåº”ç”¨ï¼‰
 *
 * ä¸¤å±‚åµŒå¥—çš„åŸå› ï¼š
 * 1. WagmiProvider       â†’ æœ€å¤–å±‚ï¼Œæä¾› Web3 åŸºç¡€èƒ½åŠ›
 * 2. QueryClientProvider â†’ ä¸­é—´å±‚ï¼Œæä¾›æ•°æ®ç®¡ç†èƒ½åŠ›
 *
 * ğŸ“Œ é‡è¦ï¼šé¡ºåºä¸èƒ½ä¹±ï¼wagmi éœ€è¦ QueryClient
 */
export function Providers({ children }: { children: React.ReactNode }) {
  return (
    // ç¬¬ä¸€å±‚ï¼šWagmiProvider - æä¾› Web3 è¿æ¥èƒ½åŠ›
    // ä¼ å…¥ä¸Šé¢é…ç½®çš„ configï¼Œå‘Šè¯‰å®ƒè¿æ¥å“ªäº›ç½‘ç»œ
    <WagmiProvider config={config}>
      {/* ç¬¬äºŒå±‚ï¼šQueryClientProvider - æä¾›æ•°æ®ç¼“å­˜èƒ½åŠ› */}
      {/* ä¼ å…¥ queryClientï¼Œç”¨äºç®¡ç†æ‰€æœ‰æ•°æ®è¯·æ±‚ */}
      <QueryClientProvider client={queryClient}>
        {/* è¿™é‡Œæ˜¯ä½ çš„åº”ç”¨å†…å®¹ï¼ˆæ‰€æœ‰é¡µé¢å’Œç»„ä»¶ï¼‰ */}
        {children}
      </QueryClientProvider>
    </WagmiProvider>
  );
}

/**
 * ============================================
 * ğŸ“– ä½¿ç”¨è¯´æ˜
 * ============================================
 *
 * 1. åœ¨ layout.tsx ä¸­å¯¼å…¥å¹¶ä½¿ç”¨ï¼š
 *    import { Providers } from './providers'
 *
 *    <body>
 *      <Providers>
 *        {children}
 *      </Providers>
 *    </body>
 *
 * 2. ç„¶ååœ¨ä»»ä½•é¡µé¢/ç»„ä»¶ä¸­éƒ½èƒ½ä½¿ç”¨ Web3 åŠŸèƒ½ï¼š
 *    import { useAccount, useBalance } from 'wagmi'
 *    const { address } = useAccount()
 *
 * ============================================
 * ğŸ”§ å¸¸è§é—®é¢˜
 * ============================================
 *
 * Q: ä¸ºä»€ä¹ˆéœ€è¦ "use client"ï¼Ÿ
 * A: å› ä¸º Web3 éœ€è¦æµè§ˆå™¨ç¯å¢ƒï¼ˆwindow.ethereumï¼‰ï¼Œ
 *    ä¸èƒ½åœ¨æœåŠ¡å™¨ç«¯è¿è¡Œ
 *
 * Q: å¯ä»¥æ·»åŠ æ›´å¤šé“¾å—ï¼Ÿ
 * A: å¯ä»¥ï¼ä» 'wagmi/chains' å¯¼å…¥å…¶ä»–é“¾ï¼Œ
 *    æ¯”å¦‚ polygon, arbitrum, optimism ç­‰
 *    å¹¶åœ¨ transports ä¸­é…ç½®å¯¹åº”çš„ http()
 */
